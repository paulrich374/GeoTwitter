$(document).on("pageshow","#index",function(f,c){var h=$.mobile.activePage.find("div[data-role='header']:visible");var g=$.mobile.activePage.find("div[data-role='footer']:visible");var b=$.mobile.activePage.find("div[data-role='content']:visible:visible");var d=$(window).height();var a=d-h.outerHeight()-g.outerHeight();if((b.outerHeight()-h.outerHeight()-g.outerHeight())<=d){a-=(b.outerHeight()-b.height())}$("#content").height(a);if(navigator.geolocation){navigator.geolocation.getCurrentPosition(success,error)}});var options={enableHighAccuracy:true,timeout:5000,maximumAge:0};function success(b){var a=b.coords}function error(a){console.warn("ERROR("+a.code+"): "+a.message)}var map,geocoder,marker,ey,my,mouseDown=false;var markerlength=0;var infoWindow=null;var pushPin=[];var o={init:function(){this.map.init()},twitter:{get:function(){var a=new Array;$(".get").find("input").each(function(c){var b=$(this),d=b.val();a[c]=d});return a},show:function(){var c=o.twitter.get(),a=new Array;for(i in c){var b=c[i];$.getJSON("http://twitter.com/users/show/"+b+".json?callback=?",function(e){var d=e.profile_image_url,f=e.screen_name;geocoder.geocode({address:e.location},function(k,h){if(h==google.maps.GeocoderStatus.OK){var g=k[0].geometry.location.lat(),m=k[0].geometry.location.lng();marker=new google.maps.Marker({icon:d,map:map,title:f,position:new google.maps.LatLng(g,m)});a.push('<div class="item">');a.push('<p class="img"><a href="#" class="open" rel="'+f+'"><img src="'+d+'" alt="" /></a></p>');a.push('<div class="entry">');a.push('<a href="#" class="open title" rel="'+f+'">'+e.name+"</a>");a.push('<p class="description">'+e.description+"</p>");a.push('<p class="url"><a href="'+e.url+'" target="_blank">'+e.url+"</a></p>");a.push('<p class="count">Followers: '+e.followers_count+", Following: "+e.friends_count+"</p>");a.push("</div>");a.push("</div>");var l=a.join("");a=[];$(".twitter").find(".inside").append(l);google.maps.event.addListener(marker,"click",function(){o.twitter.open(this.title)})}})})}},click:function(){$(".twitter").find(".open").live("click",function(){var b=$(this),a=b.attr("rel");o.twitter.open(a)})},open:function(b){var c=$(".posts"),a=new Array;$.getJSON("http://twitter.com/status/user_timeline/"+b+".json?count=5&callback=?",function(e){$.each(e,function(g,f){a.push('<div class="post">');a.push(f.text);a.push("</div>")});var d=a.join("");c.html(d).fadeIn()})}},map:{init:function(){var a=12;map=new google.maps.Map(document.getElementById("map_canvas"),{zoom:a,center:new google.maps.LatLng(34.008054,-118.426506),mapTypeId:google.maps.MapTypeId.ROADMAP});geocoder=new google.maps.Geocoder();google.maps.event.addListener(map,"dragstart",function(){$(".posts").hide()});google.maps.event.addListener(map,"click",function(c){placeMarker(c.latLng);var e=c.latLng;var d=e.lat();var b=e.lng();loadNearbyTweet(d,b)})}},scroll:{mouse:function(a){var b=a.pageY;return b},check:function(c){var b=$(".twitter").height(),a=$(".twitter").find(".inside").height();if(c<(b-a)){c=b-a}else{if(c>0){c=0}}return c},update:function(c){var d=o.scroll.mouse(c),a=d-my,b=ey+a;check=o.scroll.check(b);$(".twitter").find(".inside").css({top:check+"px"})},init:function(){$(".twitter").find(".inside").bind({mousedown:function(c){c.preventDefault();mouseDown=true;var a=o.scroll.mouse(c);my=a;var b=$(this).position();ey=b.top;o.scroll.update(c)},mousemove:function(a){if(mouseDown){o.scroll.update(a)}return false},mouseup:function(){if(mouseDown){mouseDown=false}return false},mouseleave:function(){if(mouseDown){mouseDown=false}return false}})}}};$(function(){o.init()});function placeMarker(b){var a=new google.maps.Marker({icon:"pin_tweet.png",position:b,map:map})}function loadNearbyTweet(k,l){var d=20;var b=k+", "+l;var m="Geo Tweets";var p=false;var g=true;var f=true;var n=true;var a=true;var e=true;var h="";var c="";h+='<a href="https://twitter.com/" target="_blank"><img src="twitter-bird-light.png" width="34" style="float:left;padding:3px 12px 0px 6px" alt="twitter bird" /></a>';h+="<h1>"+m+' <span style="font-size:13px"><a href="https://twitter.com/'+b+'" target="_blank">@'+b+" within 1 mile</a></span></h1>";c+='<div id="loading-container"><img src="images/ajax-loader.gif" width="32" height="32" alt="tweet loader" /></div>';$("#twitter-feed").html(h+c);$.getJSON("test.php?lat="+k+"&lng="+l,function(G){markerlength=G.statuses.length;if(G.statuses.length==0){alert("Sorry, no tweets around here.");return false}var q="";var v=1;var F=0;for(var w=0;w<G.statuses.length;w++){var E=G.statuses[w].user.name;var u=G.statuses[w].user.screen_name;var r=G.statuses[w].user.profile_image_url_https;var t=G.statuses[w].text;var C=false;var D=false;var z=G.statuses[w].id_str;if(!(G.statuses[w].coordinates)){if(F==G.statuses.length-1){alert("Sorry, no tweets around here.");return false}F++;continue}var A=G.statuses[w].coordinates.coordinates[0];var B=G.statuses[w].coordinates.coordinates[1];if(typeof G.statuses[w].retweeted_status!="undefined"){r=G.statuses[w].retweeted_status.user.profile_image_url_https;E=G.statuses[w].retweeted_status.user.name;u=G.statuses[w].retweeted_status.user.screen_name;z=G.statuses[w].retweeted_status.id_str;t=G.statuses[w].retweeted_status.text;C=true}if(G.statuses[w].text.substr(0,1)=="@"){D=true}if((G.statuses[w].text.length>1)&&(v<=d)){infoWindow=new google.maps.InfoWindow();pushPin[w]=new google.maps.Marker({icon:r,lat:B,lng:A,map:map,title:u,position:new google.maps.LatLng(B,A)});var s=pushPin[w];google.maps.event.addListener(s,"click",function(){$("div").remove("#flickr");var x='<div id="flickr"><img width="16" height="16" src="flickr.png" alt="Flickr"><a>Nearby Flickr images</a><div id=images><img id="loading" width=48 height=48 src="ajax-loader.gif"></div></div>';var H={time:20080807,position:new google.maps.LatLng(this.lat,this.lng),rank:"checkered_flag_64",cover:this.icon,sidebarItem:this.title,content:q+x};infoWindow.setOptions(H);var I;var y="";$.getJSON("http://api.flickr.com/services/rest/?api_key=8a96dfd6fac4c4eb23eee601af2b07a6&method=flickr.photos.search&lat="+this.lat+"&lon="+this.lng+"&radius=1&radius_units=mi&per_page=10&format=json&jsoncallback=?",function(J){$.each(J.photos.photo,function(L,M){var K="http://farm"+M.farm+".static.flickr.com/"+M.server+"/"+M.id+"_"+M.secret+"_z.jpg";$("<img/>").attr({src:K,width:"48",height:"48","class":"frpopup",id:"fr"+L}).prependTo("#images");if(L==J.photos.photo.length-1){$("#images").find("#loading").css("display","none")}})});infoWindow.open(map,this)});if(f==true){t=addlinks(t)}if(v==1){q+=h}q+='<div class="twitter-article" id="tw'+v+'">';q+='<div class="twitter-pic"><a href="https://twitter.com/'+u+'" target="_blank"><img src="'+r+'"images/twitter-feed-icon.png" width="42" height="42" alt="twitter icon" /></a></div>';q+='<div class="twitter-text"><p><span class="tweetprofilelink"><strong><a href="https://twitter.com/'+u+'" target="_blank">'+E+'</a></strong> <a href="https://twitter.com/'+u+'" target="_blank">@'+u+'</a></span><span class="tweet-time"><a href="https://twitter.com/'+u+"/status/"+z+'" target="_blank">'+relative_time(G.statuses[w].created_at)+"</a></span><br/>"+t+"</p>";if((C==true)&&(e==true)){q+='<div id="retweet-indicator"></div>'}if(a==true){q+='<div id="twitter-actions"><div class="intent" id="intent-reply"><a href="https://twitter.com/intent/tweet?in_reply_to='+z+'" title="Reply"></a></div><div class="intent" id="intent-retweet"><a href="https://twitter.com/intent/retweet?tweet_id='+z+'" title="Retweet"></a></div><div class="intent" id="intent-fave"><a href="https://twitter.com/intent/favorite?tweet_id='+z+'" title="Favourite"></a></div></div>'}q+="</div>";q+="</div>";v++}else{alert("Sorry, no tweets around here.");return false}}$("#twitter-feed").html(q);if(a==true){$(".twitter-article").hover(function(){$(this).find("#twitter-actions").css({display:"block",opacity:0,"margin-top":-20});$(this).find("#twitter-actions").animate({opacity:1,"margin-top":0},200)},function(){$(this).find("#twitter-actions").animate({opacity:0,"margin-top":-20},120,function(){$(this).css("display","none")})});$("#twitter-actions a").click(function(){var x=$(this).attr("href");window.open(x,"tweet action window","width=580,height=500");return false})}}).error(function(r,t,s){var q="";if(r.status===0){q="Connection problem. Check file path and www vs non-www in getJSON request"}else{if(r.status==404){q="Requested page not found. [404]"}else{if(r.status==500){q="Internal Server Error [500]."}else{if(exception==="parsererror"){q="Requested JSON parse failed."}else{if(exception==="timeout"){q="Time out error."}else{if(exception==="abort"){q="Ajax request aborted."}else{q="Uncaught Error.\n"+r.responseText}}}}}}alert("error: "+q)});google.maps.event.addListener(map,"click",function(){infoWindow.close()})}for(var j=0;j<markerlength;j++){var marker=pushPin[j];google.maps.event.addListener(marker,"click",function(){infowindow.setContent(this.html);infowindow.open(map,this)})}function addlinks(a){a=a.replace(/((https?|s?ftp|ssh)\:\/\/[^"\s\<\>]*[^.,;'">\:\s\<\>\)\]\!])/g,function(b){return'<a href="'+b+'" >'+b+"</a>"});a=a.replace(/\B@([_a-z0-9]+)/ig,function(b){return'<a href="http://twitter.com/'+b.substring(1)+'" style="font-weight:lighter;" target="_blank">'+b.charAt(0)+b.substring(1)+"</a>"});a=a.replace(/\B#([_a-z0-9]+)/ig,function(b){return'<a href="https://twitter.com/search?q='+b.substring(1)+'" style="font-weight:lighter;" target="_blank">'+b.charAt(0)+b.substring(1)+"</a>"});return a}function relative_time(d){var b=d.split(" ");d=b[1]+" "+b[2]+", "+b[5]+" "+b[3];var a=Date.parse(d);var e=(arguments.length>1)?arguments[1]:new Date();var f=parseInt((e.getTime()-a)/1000);var c=d.substr(4,2)+" "+d.substr(0,3);f=f+(e.getTimezoneOffset()*60);if(f<60){return"1m"}else{if(f<120){return"1m"}else{if(f<(60*60)){return(parseInt(f/60)).toString()+"m"}else{if(f<(120*60)){return"1h"}else{if(f<(24*60*60)){return(parseInt(f/3600)).toString()+"h"}else{if(f<(48*60*60)){return c}else{return c}}}}}}};